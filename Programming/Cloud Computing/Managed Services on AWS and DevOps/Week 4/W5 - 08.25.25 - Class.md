[[Container Orchestration]] [[Container]]

Docker file is used to containerize an application

### Typical development pipeline
code -> deployed to code repo (git hub) -> you compile it with CI (Jenkins or git lab) -> CD continuous deployment tools (harness/UCD) -> SDLC testing and load testing -> Production

### Docker
Docker -> image repo (AWS ECR, docker hub) -> CD -> dev, test, prod 

### Deployment environment 
Host 1 -> app 1, app 2, app 3

To avoid having 1 point of failure, we add another host:

Host 2 -> app 1, app 2, app 3 

#### You can also add a disaster recovery set up
dev, test, prod -> inside your disaster recovery set up

#### After having all of these environments - VMs how do you maintain all containers organized?
How do you know what is running what? Spreadsheets are not scalable so we use **container orchestration**

# Container Orchestration
automating the networking and management of containers 

You have to be able to scale your containers, run many containerized applications, running versions, integration with CI/CD

## How does container orchestration work?

Cluster = logical container made up of multiple hosts 

You can split by environment - by testing applications for example or by business unit as well, how you share resources between your clusters depends on you and your needs. 

## Challenges - Orchestration Tools
You are running from data center (kubernetes (K8S) or you are purchasing a 3rd party solution like OpenShift, cloud provider ECS) 
- The professor recommended learning K8S 

Amazon also has Amazon EKS - kubernetes inside AWS

*Control plane* -> Creating the resources 

*data plane* -> activities of the container itself 

ECS -> easy solution if you have containers 
- Fully managed

Amazon EKS -> if you already have experience with kubernetes
- Kubernetes controlled 
![[Pasted image 20250824093345.png]]

*EC2* -> server based
- You have to manage the infrastructure - patching, choose what type of server, etc.
*AWS Fargate* -> Serverless
- You don't control what resources are used -> example, you don't choose the version, CPU type (amd, intel), etc. 
## ECS - Elastic Container Service 
Register servers (serverless or server based) you have container instances that you give to ECS to manage. ECS' job is to schedule and orchestrate: 
*cluster manager and placement engine*

*placement engine* -> You specify the specs of the server where the container will run

*First you create a cluster* -> container instance has machines inside that are running the containers

*second you create a task definition* -> Json that containers all the metadata for the container 
![[Pasted image 20250824094241.png]]

Then you can run the container. There are variations to running a container:

### Task vs service - basically: on demand workloads vs long running apps
- One time run is a task
- If you want to run it as a web server, for example, long running -> that is a service

When you are running a service and something happens to the server, ECS can replace the instance. 

Both task and service use the task definition to get instantiated

On demand workloads are good for:
batch jobs, interval runs, RunTask API (task triggered by API)

Long running:
ECS service scheduler, health management, scale up and scale down 
### Task Definition
There are templates to build these json.

# On Hands Demonstration - ECS
When first creating a ECS, this managed service will create an auto scaling group for you. 
- If you choose EC2 instances, you still need to maintain these servers, patch them, replace them if there's new versions, etc. 
- If you choose fargate, you still want to know how much resources are being consumed, so enable enhanced observation metrics. 

When choosing *Fargate* you can't see the underlying infrastructure. 

### Scheduled Tasks
You can schedule container deployment for batch operations 

### Cluster Modifications
You can always modify the cluster after it's been created

## Creating a Task Definition 
You choose the launch type again (Fargate vs EC2) 

Networking:
- awsvpc is chosen for us - good option according to the professor 
- bridge mode -> how kubernetes does networking

CPU - you choose the memory depending on what you are running 

*Task Execution Role* -> agent running on the instance that talks to the control plane - you give permissions to the agent to run things on your behalf 
- Talking to the instances
- policy managed by AWS - this task execution role is allowing ECS to go grab the image form the registry 
![[Pasted image 20250824100246.png]]

*Task Role* - you are running a container that is performing tasks inside your cloud environment - to perform all this tasks, the container needs permission to talk to other AWS services 
- Talking to services outside of the execution role services mentioned above. 

*Task Execution Role vs Task Role* -> One gives permissions to ECS (Task Execution role) and the other one (Task Role) is the permissions for the task. 

> [!NOTE] Task Permissions
>For permissions, first you have to create a permission - IAM policies create roles. 


Resources allocation -> soft or hard limits to resources used by the container 

Restart policy -> what happens if a container breaks

## Creating a Service
We use the task definition to create a service (also a task)

You select the task definition we created 

*replicas* -> how many tasks to launch 

*availability zone rebalnace* -> we turn this on with 2 subnets to have high availability 

After creating the service, you get a notification that you can view the service through CloudFormation, AWS creates a infrastructure as a code, that way you avoid clicking everything and you can just deploy the script provided by CloudFormation
- both cluster and service 
- you will see all the specs as json


## Tasks Scenario: FINRA ETL 
Only runs after the market closes 


# ! Pending Transcribe notes from notebook

--- 
### Resources
https://www.youtube.com/watch?v=EqE9LXE3_L0&t=2084s

https://aws.amazon.com/blogs/big-data/how-finra-established-real-time-operational-observability-for-amazon-emr-big-data-workloads-on-amazon-ec2-with-prometheus-and-grafana/

https://aws.amazon.com/blogs/publicsector/analytics-without-limits-finras-scalable-and-secure-big-data-architecture-part-1/

https://aws.amazon.com/what-is/container-orchestration/

https://cloud.google.com/discover/what-is-container-orchestration?hl=en

https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html

https://aws.amazon.com/ecs/features/#topic-4