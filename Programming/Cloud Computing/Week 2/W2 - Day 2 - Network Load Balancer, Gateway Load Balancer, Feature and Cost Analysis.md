[[Network]] [[Protocols]] [[Cost Analysis]]

### Differences:
Both direct traffic, but they handle different types of traffic.

- Network -> It redirects traffic, but it does not look at whats inside the packets. Its a faster way of redirecting. Using an analogy, the network balancer is like a high way toll booth, it only looks at the license plate, if its allowed to go in it can, but it really doesn't check what's inside the car. 

- Application -> Like a hotel concierge, who reads your reservation details, understands what type of room you requested and directs you accordingly

## Network Load Balancer

Similar to the application load balancer:
- Listener
- Port
- Target

It works on the layer 4 (*Transport Layer*) of the OSI model, so it can support the following protocols:
- TCP traffic 
- UDP -> Good for games or voice calls. 
	- In the gaming example, think about World of Warcraft servers and layers
- And others...

It redirects traffic based on IP address and port, which is extremely fast because its based on routing decisions. This makes it capable of handling millions of requests per second. 

NLB sees connections, not individual requests

*You can think of it like a postal sorting facility that sorts via zip code*

Perfect for high performance scenarios like: communication, financial systems, gaming, IoT data collection

*IoT* -> We use a network load balancer because the IoT is already tuned to gather specific data, so the load balancer does not need to look at it in order to distribute it across the servers

#### Connection Persistence - Connection Level Load Balancing
Once there is a connection between a device and a EC2 instance or any other target, the connection is permanent for the entire life of the connection. 
- This delivers great performance 
- This is called 'sticky' connection

*Network Load Balancer I see a new TCP connecting coming in, i'll send it to server A until someone closes the connection*

Imagine you are playing World of Warcraft, when you log in it connects you to server/layer 1, you don't want to have your game interrupted, so it keeps you there.

### How to identify which instance to send traffic?
*Flow hash* -> hash value, hash code, is a numerical value generated by a hash function based on the input data. It helps ensure that incoming packets or connections are evenly distributed to achieve load balancing and optimal load utilization. 

Internal logic that puts together several components, source IP, target IP, port, etc. and with these it decides to which EC2 instance to send 


### Differences between application load balancer and network load balancer
Does not have path based routing or authentication flow.

*Path based routing* -> technique commonly used to direct incoming requests to specific back end resources based on the path in the request URL.
- For example, if you are in /home and you click _Products_ it will send you to the /store directory 

### Strength
It can redirect millions of requests fast


#### Practice Quiz Question: Which type of traffic does a Network Load Balancer primarily handle?
TCP and UDP


## Gateway Load Balancer
Sits before the target, its a 'bump' in the wire. Acts as a firewall to determine if receiving packets are safe.

![[Pasted image 20250611160356.png]]

![[Pasted image 20250611160443.png]]
Gateway load balancer sends the packet to the security appliances -> this can be cloud services or 3rd party

#### Practice Question: In which layer of the OSI model does a Gateway Load Balancer primarily operate?
Layer 3 - Network layer 


### Elastic Load Balancing
This is an umbrella term, it can be used in different parts of an application. There is not best balancer, it depends on how best it fits to your needs.

- Application load balancer
- Network load balancer
- Gateway load balancer


### Summary

NLB operates at the transport layer (layer 4), and it distributes network traffic to multiple backend targets, such as EC2 instances or containers
- Based on IP protocols (TCP/UDP)

Gateway load balancer can inspect traffic data to and from VPC and determine if they are safe 

#### Practice Quiz Question: Your customer is looking for a load balancer that can handle millions of requests per second. What would be your recommendation for the best fit for this situation?
Network balancer 


# Feature Analysis 

## Target group feature analysis 
![[Pasted image 20250611162420.png]]

*Type* -> What is the load balancer communicating with  

*Target Group* -> is a logical grouping of EC2 instances that sits behind a load balancer where traffic is forwarded to based on certain rules

a network balancer can send information to an application load balancer 

A balancer can also access a local data center if a hybrid cloud is set up.

A target group can't be on multiple VPC 

*Timeout* -> part of the health check, how long the system waits for a response from a target (server/instance) before considering it unresponsive and taking action
- You don't want this value to be too high, because it can be risky to keep a unhealthy instance 

*Target Registration* -> part of a process, you decide which instances are part of the group

*Tag* -> identifying tool 

*Attributes*:
- Deregistration delay -> time duration to allow existing requests to be completed before removing an instance from the target group.
- Slow start duration -> Period when a new instance when added, can receive an increasing number of requests until it reaches the 'fair share'.
- LB Algorithm
	- Round robin -> picks one at the time
	- Least outstanding -> directs requests to the instance with the least ongoing or pending requests 
- Stickiness -> Relevant to applications that require session management. Information about the users is kept for the duration of the users session. This is where cookies come into play, the load balancer can create it. 

#### Practice quiz question: The primary purpose of a target group in load balancing is to:
Group backend instances for distributing traffic.


## Load Balancer Features
![[Pasted image 20250611165204.png]]


*Integrated services* -> This is what allows oauth to work. It can integrate with other security services. 

- Caching -> Customers are coming from the entire planet, so you want some of the data cashed close to the customer to lower latency. 

*Network* -> ENIs 

*Attributes*:
- Cross zones -> multiple AZ can talk to EC2 instances that are not in the same AZ
- Desync Mitigation -> way to which allow requests that strictly conform to RFC specification or to what requests should look like 
	- There needs to be a strategy to filter out wrong requests
	- Most applications don't conform to RFC, so you can't filter out requests because you will be filtering out correct requests. 
- Time-out -> how long the request can stay idle

- *IP* -> v4 or/and v6
	- IPv4 and IPv6 -> Are addressing protocols for network devices
		- IPv4 uses 32 bit addresses
		- IPv6 uses 128 bit, handles more devices, offers security and aids internet growth by transitioning from IPv4 

*Scheme* -> are you going to load balance inside your data center or work with internet 

*ALB Rules*: 
- Condition -> what its evaluating (path, account, header)
- Action -> what will it do. 
	- TG1 or TG2
	- Weight -> percentage of users
	- Stickiness -> will one user stay in one instance?
- This is a if statement 

Security Group and Listener-> Opens the port  

Routing -> to what group will it be sent 

Metrics -> Monitoring, how the load balancer is doing
- Rule evaluation count -> how many rules are being evaluated 
- New connection -> new 
- Active -> existing 

*Load balanacer capacity unit  LCU* -> measures the dimensions on which the application load balancer processes traffic. 

Quantifies the capacity of an ELB. 

AWS charges based on LCUs, so understanding and optimizing how you use a ELBs can help you save money 


#### Practice quiz question: What does "cross-zone load balancing" refer to in a load balancer?
Balancing traffic between different availability zones in a region


## How much does a Load Balancer cost?
Real pricing changes over a period of time, but you can determine the overall cost 

Fixed fee -> 
- 0.0225 per ALB hour or partial hour
- 0.008 per LCU 

![[Pasted image 20250611174950.png]]

![[Pasted image 20250611175132.png]]



--- 
#### Source

https://docs.aws.amazon.com/elasticloadbalancing/latest/application/capacity-unit-reservation.html